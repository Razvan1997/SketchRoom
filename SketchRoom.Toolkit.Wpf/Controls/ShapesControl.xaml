<UserControl
    x:Class="SketchRoom.Toolkit.Wpf.Controls.ShapesControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="clr-namespace:SketchRoom.Toolkit.Wpf.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:SketchRoom.Toolkit.Wpf.Controls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="clr-namespace:SketchRoom.Models.Shapes;assembly=SketchRoom.Models"
    xmlns:svgc="http://sharpvectors.codeplex.com/svgc/"
    x:Name="Root"
    d:DesignHeight="450"
    d:DesignWidth="800"
    mc:Ignorable="d">

    <UserControl.Resources>
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
        <converters:InverseNullToVisibilityConverter x:Key="InverseNullToVisibilityConverter" />

        <Style x:Key="CustomExpanderStyle" TargetType="Expander">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Expander">
                        <StackPanel>
                            <ToggleButton
                                HorizontalContentAlignment="Left"
                                Background="Transparent"
                                BorderThickness="0"
                                Content="{TemplateBinding Header}"
                                ContentTemplate="{TemplateBinding HeaderTemplate}"
                                Focusable="False"
                                IsChecked="{Binding IsExpanded, RelativeSource={RelativeSource TemplatedParent}}">
                                <ToggleButton.Template>
                                    <ControlTemplate TargetType="ToggleButton">
                                        <ContentPresenter />
                                    </ControlTemplate>
                                </ToggleButton.Template>
                            </ToggleButton>

                            <ContentPresenter x:Name="ExpandSite" Visibility="Collapsed" />
                        </StackPanel>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsExpanded" Value="True">
                                <Setter TargetName="ExpandSite" Property="Visibility" Value="Visible" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Grid x:Name="RootLayout">

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <!--  Search bar  -->
            <RowDefinition Height="*" />
            <!--  ScrollViewer + ItemsControl  -->
        </Grid.RowDefinitions>

        <!--  Search  -->
        <!--<Grid
            Height="30"
            Margin="0,0,0,10"
            Background="#404040"
            ClipToBounds="True">

        -->
        <!--<TextBox
                Padding="8,4,30,4"
                VerticalContentAlignment="Center"
                Background="Transparent"
                BorderBrush="#555"
                BorderThickness="1"
                FontSize="14"
                Foreground="White"
                Text="{Binding SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />-->

        <!--  Icon de căutare în partea dreaptă  -->
        <!--
            <svgc:SvgViewbox
                Width="16"
                Height="16"
                Margin="0,0,10,0"
                HorizontalAlignment="Right"
                VerticalAlignment="Center"
                Source="pack://application:,,,/SketchRoom.Toolkit.Wpf;component/Resources/search.svg" />
        </Grid>-->

        <ScrollViewer
            Grid.Row="1"
            CanContentScroll="True"
            HorizontalScrollBarVisibility="Disabled"
            VerticalScrollBarVisibility="Auto">

            <ItemsControl ItemsSource="{Binding GroupedFilteredShapes}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Expander
                            Header="{Binding Category}"
                            IsExpanded="{Binding IsInitiallyExpanded}"
                            Style="{StaticResource CustomExpanderStyle}">
                            <Expander.HeaderTemplate>
                                <DataTemplate>
                                    <DockPanel Margin="4" VerticalAlignment="Center">
                                        <svgc:SvgViewbox
                                            x:Name="Arrow"
                                            Width="12"
                                            Height="12"
                                            Margin="0,0,6,0"
                                            RenderTransformOrigin="0.5,0.5"
                                            Source="pack://application:,,,/SketchRoom.Toolkit.Wpf;component/Resources/arrow-right.svg"
                                            Stretch="Uniform">
                                            <svgc:SvgViewbox.RenderTransform>
                                                <RotateTransform Angle="0" />
                                            </svgc:SvgViewbox.RenderTransform>
                                        </svgc:SvgViewbox>

                                        <TextBlock
                                            Margin="6,0,0,0"
                                            FontSize="14"
                                            FontWeight="Bold"
                                            Foreground="White"
                                            Text="{Binding}" />
                                    </DockPanel>

                                    <DataTemplate.Triggers>
                                        <DataTrigger Binding="{Binding IsExpanded, RelativeSource={RelativeSource AncestorType=Expander}}" Value="True">
                                            <DataTrigger.EnterActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <DoubleAnimation
                                                            Storyboard.TargetName="Arrow"
                                                            Storyboard.TargetProperty="(RenderTransform).(RotateTransform.Angle)"
                                                            To="90"
                                                            Duration="0:0:0.2" />
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </DataTrigger.EnterActions>

                                            <DataTrigger.ExitActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <DoubleAnimation
                                                            Storyboard.TargetName="Arrow"
                                                            Storyboard.TargetProperty="(RenderTransform).(RotateTransform.Angle)"
                                                            To="0"
                                                            Duration="0:0:0.2" />
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </DataTrigger.ExitActions>
                                        </DataTrigger>
                                    </DataTemplate.Triggers>
                                </DataTemplate>
                            </Expander.HeaderTemplate>

                            <ItemsControl ItemsSource="{Binding Items}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel Orientation="Horizontal" />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>

                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border
                                            Width="90"
                                            Height="90"
                                            Margin="5"
                                            Background="Transparent"
                                            MouseEnter="OnShapeMouseEnter"
                                            MouseLeave="OnShapeMouseLeave"
                                            PreviewMouseDown="OnShapeMouseDown"
                                            PreviewMouseMove="OnShapeMouseMove"
                                            PreviewMouseUp="OnShapeMouseUp">

                                            <Viewbox Stretch="Uniform">
                                                <Grid
                                                    Width="100"
                                                    Height="100"
                                                    Background="Transparent">
                                                    <ContentControl
                                                        HorizontalAlignment="Center"
                                                        VerticalAlignment="Center"
                                                        Content="{Binding ShapeContent}"
                                                        Visibility="{Binding ShapeContent, Converter={StaticResource NullToVisibilityConverter}}" />

                                                    <svgc:SvgViewbox
                                                        Width="100"
                                                        Height="100"
                                                        Source="{Binding SvgUri}"
                                                        Stretch="Uniform"
                                                        Visibility="{Binding ShapeContent, Converter={StaticResource InverseNullToVisibilityConverter}}" />
                                                </Grid>
                                            </Viewbox>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </Expander>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

        </ScrollViewer>


        <!--<Canvas
            x:Name="PopupHost"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch"
            IsHitTestVisible="False" />-->
    </Grid>
</UserControl>